name: "control4d-multiview"
tag: "${rmspace:${system.prompt_processor.prompt},_}"
exp_root_dir: "outputs"
seed: 0

data_type: "multiview-camera-datamodule"
data:
  train_downsample_resolution: 1
  eval_downsample_resolution: 1
  dataroot: dataset/twindom

system_type: "control4d-multiview-system"
system:
  start_editing_step: 2000
  patch_size: 128
  geometry_type: "implicit-volume"
  geometry:
    radius: 1.
    n_feature_dims: 35
    normal_type: analytic
    pos_encoding_config:
      otype: HashGrid
      n_levels: 16
      n_features_per_level: 2
      log2_hashmap_size: 19
      base_resolution: 16
      per_level_scale: 1.4472692374403782 # max resolution 4096
    density_bias: "blob_magic3d"
    density_activation: softplus
    density_blob_scale: 10.
    density_blob_std: 0.5
    isosurface_resolution: 128
    isosurface_threshold: auto
    isosurface_coarse_to_fine: true

  material_type: "hybrid-rgb-latent-material"
  material:
    n_output_dims: 35

  background_type: "solid-rgb-feature-background"
  background:
    n_output_dims: 35
    color: 0.0
    feature: 0.0

  renderer_type: "gan-volume-renderer"
  renderer:
    radius: ${system.geometry.radius}
    num_samples_per_ray: 512

  guidance_type: "controlnet-guidance"
  guidance:
    cache_dir: "/root/autodl-tmp/cache"
    control_type: "normal"
    min_step_percent: 0.05
    max_step_percent: 0.8
    condition_scale: 0.75
  
  prompt_processor_type: "stable-diffusion-prompt-processor"
  prompt_processor:
    pretrained_model_name_or_path: "runwayml/stable-diffusion-v1-5"
    prompt: "Elon Musk wearing white shirt, RAW photo, (high detailed skin:1.2), 8k uhd, dslr, soft lighting, high quality, film grain, Fujifilm XT3"
    # negative_prompt: "(overexposed, underexposed, out of focus, deformed iris, deformed pupils, semi-realistic, cgi, 3d, render, sketch, cartoon, drawing, anime:1.4), text, close up, cropped, out of frame, worst quality, low quality, jpeg artifacts, ugly, duplicate, morbid, mutilated, extra fingers, mutated hands, poorly drawn hands, poorly drawn face, mutation, deformed, blurry, dehydrated, bad anatomy, bad proportions, extra limbs, cloned face, disfigured, gross proportions, malformed limbs, missing arms, missing legs, extra arms, extra legs, fused fingers, too many fingers, long neck"

  loggers:
    wandb:
      enable: false
      project: 'threestudio'

  loss:
    lambda_sds: 0.
    lambda_orient: [0, 10.0, 1000., 5000.0]
    # lambda_orient: [0, 0.0001, 1000, 0.00001]
    lambda_sparsity: 1.0
    lambda_opaque: 1.0
    lambda_l1: 10.
    lambda_p: 10.
    lambda_kl: 0.000001
    lambda_G: 0.0001
    lambda_D: 1.
  optimizer:
    name: Adam
    args:
      lr: 0.01
      betas: [0.9, 0.99]
      eps: 1.e-15
    params:
      geometry:
        lr: 0.01
      background:
        lr: 0.001
      renderer.generator:
        lr: 0.0002
      renderer.local_encoder:
        lr: 0.0001
      renderer.global_encoder:
        lr: 0.0001
    optimizer_dis:
      name: Adam
      args:
        lr: 0.01
        betas: [0.9, 0.99]
        eps: 1.e-15
      params:
        renderer.discriminator:
          lr: 0.00001

trainer:
  max_steps: 10000
  log_every_n_steps: 1
  num_sanity_val_steps: 0
  val_check_interval: 200
  enable_progress_bar: true
  precision: 16-mixed

checkpoint:
  save_last: true
  save_top_k: -1
  every_n_train_steps: ${trainer.max_steps}
